<div id="post-container">
	@if (posts() && posts()!.length > 0) {
		@for (post of posts(); track post.id) {
			<div class="post">
				<div class="post-meta">
					@let fromOther = post.author.id !== post.host.id;
					@let template = mode === 'feed' ? forFeed : forWall;

					<ng-container
						*ngTemplateOutlet="template; context: { post, fromOther }"
					></ng-container>

					@if (post.createdAt) {
						<span>{{ humanTime(post.createdAt) }}</span>
					}
				</div>

				<div>{{ post.content || 'No content' }}</div>

				<input type="text" placeholder="Add a comment..." (keydown.enter)="addComment($any($event.target), post.id); $any($event.target).value = ''"/>

				@if (post.comments) {
					<div class="comment-pane">
						@for (comment of post.comments; track comment.id) {
							<div class="comment">
								<div class="comment-meta">
									<a
										[routerLink]="['/profile']"
										[queryParams]="{ user: comment.author.username }"
										>{{ comment.author.username || 'Unknown' }}</a
									>,

									@if (comment.createdAt) {
										<span>{{ humanTime(comment.createdAt) }}</span>
									}
								</div>
								<div>{{ comment.content }}</div>
							</div>
						}
					</div>
				}
			</div>
		}
	} @else {
		<div>No posts found.</div>
	}
</div>

<ng-template #forFeed let-post="post" let-fromOther="fromOther">
	@if (fromOther) {
		<a [routerLink]="['/profile']" [queryParams]="{ user: post.host.username }"
			>{{ post.host.username || 'Unknown' }}</a
		>&gt;
	}

	<a
		[routerLink]="['/profile']"
		[queryParams]="{ user: post.author.username }"
		>{{ post.author.username || 'Unknown' }}</a
	>,
</ng-template>

<ng-template #forWall let-post="post">
	<a
		[routerLink]="['/profile']"
		[queryParams]="{ user: post.author.username }"
		>{{ post.author.username || 'Unknown' }}</a
	>,
</ng-template>
